<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kingdom Connection</title>
    <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiS2luZ2RvbSBDb25uZWN0aW9uIiwic2hvcnRfbmFtZSI6Iktpbmdkb20iLCJzdGFydF91cmwiOiIvIiwiZGlzcGxheSI6InN0YW5kYWxvbmUiLCJiYWNrZ3JvdW5kX2NvbG9yIjoiI2Y4ZjlmYSIsInRoZW1lX2NvbG9yIjoiIzY2N2VlYSIsImljb25zIjpbeyJzcmMiOiJodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vY2hhbmVsbGVqYW5hZS9raW5nZG9tY29ubmVjdGlvbi9tYWluL2xvZ28ucG5nIiwic2l6ZXMiOiI1MTJ4NTEyIiwidHlwZSI6ImltYWdlL3BuZyJ9XX0=">
    <link rel="icon" href="https://raw.githubusercontent.com/chanellejanae/kingdomconnection/main/logo.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Kingdom Connection">
    <link rel="apple-touch-icon" href="https://raw.githubusercontent.com/chanellejanae/kingdomconnection/main/logo.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
            margin: 0;
            padding: 0;
            background: #f8f9fa;
            color: #2d3748;
            line-height: 1.6;
            font-weight: 400;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .navbar {
            background: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .nav-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo {
            width: 40px;
            height: 40px;
            border-radius: 8px;
        }

        .logo-large {
            width: 120px;
            height: 120px;
            border-radius: 20px;
            filter: drop-shadow(0 0 30px rgba(102, 126, 234, 0.4));
            animation: glow 2s ease-in-out infinite alternate;
        }

        @keyframes glow {
            from { filter: drop-shadow(0 0 30px rgba(102, 126, 234, 0.4)); }
            to { filter: drop-shadow(0 0 40px rgba(102, 126, 234, 0.6)); }
        }

        .logo-text {
            font-family: 'Poppins', sans-serif;
            font-size: 1.5rem;
            font-weight: 600;
            color: #2d3748;
        }

        .nav-tabs {
            display: flex;
            gap: 2rem;
        }

        .nav-tab {
            padding: 0.5rem 1rem;
            border: none;
            background: none;
            color: #718096;
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.2s;
            font-size: 0.95rem;
        }

        .nav-tab.active {
            color: #4299e1;
            background: #ebf8ff;
        }

        .nav-tab:hover {
            color: #4299e1;
            background: #f7fafc;
        }

        .profile-section {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .profile-pic {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: #e2e8f0;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1.2rem;
            overflow: hidden;
        }

        .profile-pic img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .days-counter {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .days-counter-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 12px;
            text-align: center;
            margin-bottom: 1.5rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            box-shadow: 0 2px 10px rgba(102, 126, 234, 0.3);
        }

        .counter-number {
            font-size: 2rem;
            font-weight: 700;
            line-height: 1;
            margin-bottom: 0.25rem;
        }

        .counter-label {
            font-size: 0.85rem;
            font-weight: 400;
            opacity: 0.9;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .main-content {
            padding: 2rem 0;
            min-height: calc(100vh - 100px);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .question-card {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            text-align: center;
        }

        .date-header {
            color: #718096;
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }

        .category-badge {
            display: inline-block;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.85rem;
            margin-bottom: 1.5rem;
        }

        .question-text {
            font-family: 'Poppins', sans-serif;
            font-size: 1.3rem;
            color: #2d3748;
            margin-bottom: 2rem;
            line-height: 1.5;
            font-weight: 500;
        }

        .partner-reflections {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .partner-section {
            background: #f7fafc;
            border-radius: 12px;
            padding: 1.5rem;
        }

        .partner-name {
            font-weight: 600;
            color: #4a5568;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .reflection-textarea {
            width: 100%;
            min-height: 120px;
            padding: 1rem;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 1rem;
            resize: vertical;
            font-family: inherit;
        }

        .reflection-textarea:focus {
            outline: none;
            border-color: #4299e1;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 500;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: #f7fafc;
            color: #4a5568;
            border: 1px solid #e2e8f0;
        }

        .btn-secondary:hover {
            background: #edf2f7;
        }

        .date-night-container {
            max-width: 600px;
            margin: 0 auto;
            text-align: center;
        }

        .date-card {
            background: white;
            border-radius: 20px;
            padding: 3rem 2rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
            min-height: 200px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .date-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(135deg, #667eea, #764ba2);
        }

        .date-card-question {
            font-family: 'Poppins', sans-serif;
            font-size: 1.4rem;
            color: #2d3748;
            margin-bottom: 1.5rem;
            line-height: 1.4;
            font-weight: 500;
        }

        .date-card-number {
            position: absolute;
            top: 1rem;
            right: 1.5rem;
            background: #f7fafc;
            color: #718096;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .date-controls {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .reflections-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .reflection-item {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
        }

        .reflection-date {
            color: #718096;
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }

        .reflection-question {
            font-weight: 500;
            margin-bottom: 1rem;
            color: #2d3748;
        }

        .reflection-answer {
            color: #4a5568;
            line-height: 1.6;
        }

        .partner-answers {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-top: 1rem;
        }

        .partner-answer {
            background: #f7fafc;
            padding: 1rem;
            border-radius: 8px;
            border-left: 3px solid #4299e1;
        }

        .settings-section {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
        }

        .settings-title {
            font-family: 'Poppins', sans-serif;
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            color: #2d3748;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #4a5568;
            text-align: left;
        }

        .form-input {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
        }

        .form-input:focus {
            outline: none;
            border-color: #4299e1;
        }

        .profile-pic-selector {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .profile-pic-large {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: #e2e8f0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            overflow: hidden;
        }

        .profile-pic-large img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .couple-id-display {
            background: #f7fafc;
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
            font-family: 'Courier New', monospace;
            font-size: 1.1rem;
            font-weight: bold;
            color: #4299e1;
            letter-spacing: 2px;
            margin-bottom: 1rem;
        }

        .sync-status {
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-size: 0.9rem;
            text-align: center;
            margin-bottom: 1rem;
        }

        .sync-status.connected {
            background: #f0fff4;
            color: #38a169;
            border: 1px solid #9ae6b4;
        }

        .sync-status.disconnected {
            background: #fffaf0;
            color: #d69e2e;
            border: 1px solid #fbd38d;
        }

        .login-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #667eea, #764ba2);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .login-card {
            background: white;
            border-radius: 20px;
            padding: 3rem;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0,0,0,0.2);
            max-width: 400px;
            width: 90%;
        }

        .login-title {
            font-family: 'Poppins', sans-serif;
            font-size: 2rem;
            font-weight: 600;
            color: #2d3748;
            margin: 1.5rem 0 0.5rem;
        }

        .login-subtitle {
            color: #718096;
            margin-bottom: 2rem;
        }

        @media (max-width: 768px) {
            .nav-tabs {
                display: none;
            }
            
            .counters-grid {
                grid-template-columns: 1fr 1fr 1fr !important;
                gap: 0.5rem !important;
            }
            
            .counters-grid .days-counter-card {
                padding: 0.75rem 0.5rem !important;
            }
            
            .counters-grid .counter-number {
                font-size: 1.5rem !important;
            }
            
            .counters-grid .counter-label {
                font-size: 0.7rem !important;
            }
            
            .mobile-nav {
                display: flex;
                justify-content: space-around;
                background: white;
                padding: 1rem 0;
                box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                z-index: 100;
            }
            
            .mobile-nav-item {
                display: flex;
                flex-direction: column;
                align-items: center;
                gap: 0.25rem;
                padding: 0.5rem;
                color: #718096;
                text-decoration: none;
                font-size: 0.8rem;
                cursor: pointer;
            }
            
            .mobile-nav-item.active {
                color: #4299e1;
            }
            
            .main-content {
                padding-bottom: 100px;
            }

            .partner-reflections {
                grid-template-columns: 1fr;
            }

            .partner-answers {
                grid-template-columns: 1fr;
            }
        }

        .hidden {
            display: none !important;
        }

        .online-indicator {
            width: 8px;
            height: 8px;
            background: #48bb78;
            border-radius: 50%;
            display: inline-block;
            margin-left: 0.5rem;
        }

        .offline-indicator {
            width: 8px;
            height: 8px;
            background: #ed8936;
            border-radius: 50%;
            display: inline-block;
            margin-left: 0.5rem;
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen" class="login-screen">
        <div class="login-card">
            <img src="https://raw.githubusercontent.com/chanellejanae/kingdomconnection/main/logo.png" alt="Kingdom Connection" class="logo-large">
            <h1 class="login-title">Kingdom Connection</h1>
            <p class="login-subtitle">Strengthen your relationship through daily reflection and prayer</p>
            
            <!-- Login Form -->
            <div id="loginForm">
                <div class="form-group">
                    <label class="form-label" for="loginEmail">Email</label>
                    <input type="email" id="loginEmail" class="form-input" placeholder="Enter your email">
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="loginPassword">Password</label>
                    <input type="password" id="loginPassword" class="form-input" placeholder="Enter your password">
                </div>
                
                <div class="form-group" style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 1rem;">
                    <input type="checkbox" id="rememberMe" style="margin: 0;">
                    <label for="rememberMe" style="margin: 0; font-size: 0.9rem; color: #4a5568;">Remember me</label>
                </div>
                
                <button class="btn btn-primary" onclick="signInUser()" style="width: 100%; margin-bottom: 1rem;">Sign In</button>
                
                <div style="text-align: center; margin-bottom: 1rem;">
                    <button class="btn btn-secondary" onclick="showSignUpForm()" style="margin-right: 0.5rem;">Create Account</button>
                    <button class="btn btn-secondary" onclick="showForgotPassword()">Forgot Password?</button>
                </div>
            </div>
            
            <!-- Sign Up Form -->
            <div id="signUpForm" style="display: none;">
                <div class="form-group">
                    <label class="form-label" for="signUpName">Your Name</label>
                    <input type="text" id="signUpName" class="form-input" placeholder="Enter your name">
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="signUpEmail">Email</label>
                    <input type="email" id="signUpEmail" class="form-input" placeholder="Enter your email">
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="signUpPassword">Password</label>
                    <input type="password" id="signUpPassword" class="form-input" placeholder="Create a password (min 6 characters)">
                </div>
                
                <button class="btn btn-primary" onclick="signUpUser()" style="width: 100%; margin-bottom: 1rem;">Create Account</button>
                
                <div style="text-align: center;">
                    <button class="btn btn-secondary" onclick="showLoginForm()">Back to Sign In</button>
                </div>
            </div>
            
            <!-- Forgot Password Form -->
            <div id="forgotPasswordForm" style="display: none;">
                <div class="form-group">
                    <label class="form-label" for="resetEmail">Email</label>
                    <input type="email" id="resetEmail" class="form-input" placeholder="Enter your email">
                </div>
                
                <button class="btn btn-primary" onclick="resetPassword()" style="width: 100%; margin-bottom: 1rem;">Send Reset Email</button>
                
                <div style="text-align: center;">
                    <button class="btn btn-secondary" onclick="showLoginForm()">Back to Sign In</button>
                </div>
            </div>
            
            <div id="authMessage" style="margin-top: 1rem; padding: 0.75rem; border-radius: 8px; text-align: center; display: none;"></div>
        </div>
    </div>

    <nav class="navbar">
        <div class="container">
            <div class="nav-content">
                <div class="logo-section">
                    <img src="https://raw.githubusercontent.com/chanellejanae/kingdomconnection/main/logo.png" alt="Kingdom Connection" class="logo">
                    <span class="logo-text">Kingdom Connection</span>
                </div>
                
                <div class="nav-tabs">
                    <button class="nav-tab active" onclick="switchTab('daily')">Daily Reflection</button>
                    <button class="nav-tab" onclick="switchTab('weekly')">Weekly</button>
                    <button class="nav-tab" onclick="switchTab('monthly')">Monthly</button>
                    <button class="nav-tab" onclick="switchTab('datenight')">Date Night</button>
                    <button class="nav-tab" onclick="switchTab('history')">History</button>
                    <button class="nav-tab" onclick="switchTab('settings')">Settings</button>
                </div>
                
                <div class="profile-section">
                    <div class="profile-pic" id="profilePic" onclick="switchTab('settings')">
                        <span id="profileInitial">👤</span>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <main class="container">
        <div class="main-content">
            <!-- Daily Reflection Tab -->
            <div id="daily" class="tab-content active">
                <div class="counters-grid" style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem; margin-bottom: 1.5rem; align-items: center;">
                    <div class="days-counter-card" id="daysCounterCard">
                        <div class="counter-number" id="daysNumber">0</div>
                        <div class="counter-label">Days Together</div>
                    </div>
                    <div class="days-counter-card" id="questionsCounterCard">
                        <div class="counter-number" id="questionsNumber">0</div>
                        <div class="counter-label">Questions Answered</div>
                    </div>
                    <div class="days-counter-card" id="streakCounterCard">
                        <div class="counter-number" id="streakNumber">0</div>
                        <div class="counter-label">Day Streak</div>
                    </div>
                </div>
                <div class="question-card">
                    <div class="date-header" id="dateHeader"></div>
                    <div class="category-badge" id="categoryBadge">✨ Spiritual Connection</div>
                    <div class="question-text" id="questionText">Loading your daily question...</div>
                    
                    <div class="partner-reflections">
                        <div class="partner-section">
                            <div class="partner-name">
                                <div class="profile-pic" style="width: 24px; height: 24px; font-size: 0.8rem; margin-right: 0.5rem;" id="yourProfilePicReflection">
                                    <span id="yourInitialReflection">👤</span>
                                </div>
                                <span id="yourName">You</span>
                                <span class="online-indicator" id="yourStatus"></span>
                            </div>
                            <textarea class="reflection-textarea" id="yourReflection" placeholder="Share your thoughts and reflections here..."></textarea>
                            <button class="btn btn-primary" onclick="saveYourReflection()" style="margin-top: 1rem; width: 100%;">Save Your Reflection</button>
                        </div>
                        
                        <div class="partner-section">
                            <div class="partner-name">
                                <div class="profile-pic" style="width: 24px; height: 24px; font-size: 0.8rem; margin-right: 0.5rem;" id="partnerProfilePicReflection">
                                    <span id="partnerInitialReflection">👤</span>
                                </div>
                                <span id="partnerName">Partner</span>
                                <span class="offline-indicator" id="partnerStatus"></span>
                            </div>
                            <div id="partnerReflectionDisplay" style="min-height: 120px; padding: 1rem; background: white; border-radius: 8px; border: 2px solid #e2e8f0; color: #718096; font-style: italic;">
                                Waiting for your partner's reflection...
                            </div>
                        </div>
                    </div>
                    

                </div>
            </div>

            <!-- Weekly Reflection Tab -->
            <div id="weekly" class="tab-content">
                <div style="text-align: center; margin-bottom: 2rem;">
                    <h2 style="color: #2d3748; margin-bottom: 0.5rem;">Weekly Relationship Reflection</h2>
                    <p style="color: #718096;">Every seven days, reflect together on your relationship journey</p>
                </div>
                
                <div class="question-card">
                    <div class="date-header" id="weeklyDateHeader">Week of [Date]</div>
                    <div class="category-badge">💕 Weekly Reflection</div>
                    <div class="question-text">How has our relationship grown this week? What are we grateful for, and what can we improve together?</div>
                    
                    <div class="partner-reflections">
                        <div class="partner-section">
                            <div class="partner-name">
                                <div class="profile-pic" style="width: 24px; height: 24px; font-size: 0.8rem; margin-right: 0.5rem;" id="yourProfilePicWeekly">
                                    <span id="yourInitialWeekly">👤</span>
                                </div>
                                <span id="yourNameWeekly">You</span>
                                <span class="online-indicator" id="yourStatusWeekly"></span>
                            </div>
                            <textarea class="reflection-textarea" id="yourWeeklyReflection" placeholder="Share your weekly reflection on our relationship..."></textarea>
                            <button class="btn btn-primary" onclick="saveWeeklyReflection()" style="margin-top: 1rem; width: 100%;">Save Weekly Reflection</button>
                        </div>
                        
                        <div class="partner-section">
                            <div class="partner-name">
                                <div class="profile-pic" style="width: 24px; height: 24px; font-size: 0.8rem; margin-right: 0.5rem;" id="partnerProfilePicWeekly">
                                    <span id="partnerInitialWeekly">👤</span>
                                </div>
                                <span id="partnerNameWeekly">Partner</span>
                                <span class="offline-indicator" id="partnerStatusWeekly"></span>
                            </div>
                            <div id="partnerWeeklyReflectionDisplay" style="min-height: 120px; padding: 1rem; background: white; border-radius: 8px; border: 2px solid #e2e8f0; color: #718096; font-style: italic;">
                                Waiting for your partner's weekly reflection...
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Monthly Goals Tab -->
            <div id="monthly" class="tab-content">
                <div style="text-align: center; margin-bottom: 2rem;">
                    <h2 style="color: #2d3748; margin-bottom: 0.5rem;">Monthly Couple Goals</h2>
                    <p style="color: #718096;">Set one meaningful goal to accomplish together this month</p>
                </div>
                
                <div class="question-card">
                    <div class="date-header" id="monthlyDateHeader">Month of [Date]</div>
                    <div class="category-badge">🎯 Monthly Goal</div>
                    <div class="question-text">What is one thing we want to do together as a couple this month?</div>
                    
                    <div class="partner-reflections">
                        <div class="partner-section">
                            <div class="partner-name">
                                <div class="profile-pic" style="width: 24px; height: 24px; font-size: 0.8rem; margin-right: 0.5rem;" id="yourProfilePicMonthly">
                                    <span id="yourInitialMonthly">👤</span>
                                </div>
                                <span id="yourNameMonthly">You</span>
                                <span class="online-indicator" id="yourStatusMonthly"></span>
                            </div>
                            <textarea class="reflection-textarea" id="yourMonthlyGoal" placeholder="Share what you'd like to do together this month..."></textarea>
                            <button class="btn btn-primary" onclick="saveMonthlyGoal()" style="margin-top: 1rem; width: 100%;">Save Monthly Goal</button>
                        </div>
                        
                        <div class="partner-section">
                            <div class="partner-name">
                                <div class="profile-pic" style="width: 24px; height: 24px; font-size: 0.8rem; margin-right: 0.5rem;" id="partnerProfilePicMonthly">
                                    <span id="partnerInitialMonthly">👤</span>
                                </div>
                                <span id="partnerNameMonthly">Partner</span>
                                <span class="offline-indicator" id="partnerStatusMonthly"></span>
                            </div>
                            <div id="partnerMonthlyGoalDisplay" style="min-height: 120px; padding: 1rem; background: white; border-radius: 8px; border: 2px solid #e2e8f0; color: #718096; font-style: italic;">
                                Waiting for your partner's monthly goal...
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Date Night Tab -->
            <div id="datenight" class="tab-content">
                <div style="text-align: center; margin-bottom: 2rem;">
                    <h2 style="color: #2d3748; margin-bottom: 0.5rem;">Date Night Questions</h2>
                    <p style="color: #718096;">Deepen your connection with these intimate conversation starters</p>
                </div>
                
                <div class="date-night-container">
                    <div class="date-card" id="dateCard">
                        <div class="date-card-number" id="cardNumber">1 / 250</div>
                        <div class="date-card-question" id="dateQuestion">Loading question...</div>
                    </div>
                    
                    <div class="date-controls">
                        <button class="btn btn-secondary" onclick="previousDateCard()" id="prevBtn">← Previous</button>
                        <button class="btn btn-primary" onclick="nextDateCard()">Next →</button>
                        <button class="btn btn-secondary" onclick="shuffleDateCards()">🔀 Shuffle</button>
                    </div>
                </div>
            </div>

            <!-- History Tab -->
            <div id="history" class="tab-content">
                <div style="text-align: center; margin-bottom: 2rem;">
                    <h2 style="color: #2d3748; margin-bottom: 0.5rem;">Your Reflections</h2>
                    <p style="color: #718096;">Look back on your journey together</p>
                </div>
                <div class="reflections-list" id="reflectionsList">
                    <!-- Reflections will be populated here -->
                </div>
            </div>

            <!-- Settings Tab -->
            <div id="settings" class="tab-content">
                <div class="settings-section">
                    <h3 class="settings-title">Profile Settings</h3>
                    
                    <div class="profile-pic-selector">
                        <div class="profile-pic-large" id="profilePicLarge">
                            <span id="profileInitialLarge">👤</span>
                        </div>
                        <div>
                            <input type="file" id="profilePicInput" accept="image/*" style="display: none;" onchange="handleProfilePicChange()">
                            <button class="btn btn-secondary" onclick="document.getElementById('profilePicInput').click()">Change Photo</button>
                            <button class="btn btn-secondary" onclick="removeProfilePic()" style="margin-top: 0.5rem;">Remove Photo</button>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="displayName">Display Name</label>
                        <input type="text" id="displayName" class="form-input" placeholder="Enter your name">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="anniversaryDate">Anniversary Date</label>
                        <input type="date" id="anniversaryDate" class="form-input">
                    </div>
                    
                    <button class="btn btn-primary" onclick="saveProfileSettings()" style="width: 100%; margin-top: 1rem;">Save Changes</button>
                </div>

                <div class="settings-section">
                    <h3 class="settings-title">Couple Sync</h3>
                    
                    <div class="sync-status disconnected" id="syncStatus">
                        Not connected to partner
                    </div>
                    
                    <div class="couple-id-display" id="coupleIdDisplay">
                        LOADING...
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="partnerCode">Partner's Code</label>
                        <input type="text" id="partnerCode" class="form-input" placeholder="Enter your partner's code">
                    </div>
                    
                    <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                        <button class="btn btn-primary" onclick="connectPartner()">Connect Partner</button>
                        <button class="btn btn-secondary" onclick="generateNewCode()">Generate New Code</button>
                    </div>
                </div>

                <div class="settings-section">
                    <h3 class="settings-title">Account</h3>
                    <button class="btn btn-secondary" onclick="signOutUser()" style="margin-right: 1rem;">Sign Out</button>
                    <button class="btn btn-secondary" onclick="exportData()">Export Reflections</button>
                </div>
            </div>
        </div>
    </main>

    <!-- Mobile Navigation -->
    <div class="mobile-nav hidden" id="mobileNav">
        <div class="mobile-nav-item active" onclick="switchTab('daily')">
            <span>📝</span>
            <span>Daily</span>
        </div>
        <div class="mobile-nav-item" onclick="switchTab('weekly')">
            <span>📅</span>
            <span>Weekly</span>
        </div>
        <div class="mobile-nav-item" onclick="switchTab('monthly')">
            <span>🎯</span>
            <span>Monthly</span>
        </div>
        <div class="mobile-nav-item" onclick="switchTab('datenight')">
            <span>💕</span>
            <span>Date Night</span>
        </div>
        <div class="mobile-nav-item" onclick="switchTab('history')">
            <span>📚</span>
            <span>History</span>
        </div>
        <div class="mobile-nav-item" onclick="switchTab('settings')">
            <span>⚙️</span>
            <span>Settings</span>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyA3jL36hYZBmQsjuI02VY8FfNRvRGuTvKk",
            authDomain: "kingdomconnection-ac1cd.firebaseapp.com",
            projectId: "kingdomconnection-ac1cd",
            storageBucket: "kingdomconnection-ac1cd.firebasestorage.app",
            messagingSenderId: ".",
            appId: "1:.:web:798bed278e7104fe153cae",
            measurementId: "G-BX9X4ZXCXX"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        // Daily Reflection Questions (370 questions across 27 categories) - KEEPING EXACTLY AS PROVIDED
        const dailyQuestions = {
            "✨ Spiritual Connection": [
                "Where have you seen God's hand in our relationship recently?",
                "What's something God is teaching you personally right now?",
                "How can we pray for and encourage each other this week?",
                "What verse has been speaking to you lately and why?",
                "How do you think God is shaping our future together?",
                "What's one area we can grow in spiritually as a couple?",
                "How can we better keep Christ at the center of our relationship?",
                "What do you feel God is calling you to surrender right now?",
                "What do you admire about how your partner walks with God?",
                "What's a promise from God you're standing on right now?"
            ],
            "💬 Emotional Intimacy": [
                "What's something that made you feel loved by me this week?",
                "What's been on your heart lately that you haven't said out loud?",
                "How can I support you better when you're stressed or discouraged?",
                "What do you think we handle really well as a couple?",
                "What's one thing you appreciate about our communication?",
                "When do you feel most connected to me?",
                "What's one fear or insecurity you want to work through together?",
                "How do you feel God has healed or changed your heart since we met?",
                "What's something small I could do that would make you feel seen or cared for?",
                "What does \"emotional safety\" look like for you?"
            ],
            "💞 Relationship Reflection": [
                "How have we grown as a couple in the past few months?",
                "What's something you've learned about me that surprised you (in a good way)?",
                "How do we bring out the best in each other?",
                "What do you envision our relationship looking like one year from now?",
                "What kind of marriage do you want to build one day (values, atmosphere, routines)?",
                "What boundaries have protected our relationship well?",
                "What boundaries could we improve or reinforce?",
                "How do you feel God is preparing us individually for the next season?",
                "What's one thing you want to always keep alive in our relationship?",
                "If we could tell our future kids one lesson about love + faith, what would it be?"
            ],
            "🌿 Gratitude + Joy": [
                "What's something small you're thankful for about me today?",
                "What's a fun memory with me that always makes you smile?",
                "What's one way we've grown stronger through challenges?",
                "What do you love most about doing life with me — even from afar?",
                "What's a moment you've felt the Holy Spirit's peace over us?",
                "What's something you want to celebrate God for this week?",
                "What's something about our love that feels sacred or special to you?",
                "What's a way you've seen God answer a prayer for our relationship?",
                "What's a simple joy you want to share with me this week?",
                "What's one thing you never want to take for granted about me?"
            ],
            "🕊 Growth + Purpose": [
                "How can we encourage each other in our callings this week?",
                "What's a dream God has placed on your heart that you're scared to pursue?",
                "How can we keep each other accountable spiritually and emotionally?",
                "What do you think our relationship teaches others about God's love?",
                "How can we use our relationship to serve others or glorify God more?",
                "What's one area of your faith journey you want me to better understand?",
                "How can we make sure our goals always honor God?",
                "What do you think God's purpose is for bringing us together?",
                "What do you need prayer for in your personal growth right now?",
                "How can we invite God's presence more intentionally into our everyday conversations?"
            ],
            "🌿 Spiritual Growth + Faith": [
                "How has God been speaking to your heart this week?",
                "What's a recent way you've seen God answer prayer in your life?",
                "How can we encourage each other to spend more time with God daily?",
                "What is a scripture you want to memorize together this month?",
                "When do you feel closest to God — in joy, in struggle, or both?",
                "How do you sense God guiding your decisions for our relationship?",
                "What's one spiritual habit you want us to build together?",
                "How has prayer shaped your perspective recently?",
                "What's a sermon, book, or devotional that impacted you deeply this year?",
                "How can we remind each other to stay faithful even in hard seasons?",
                "What's a way God has shown His faithfulness in your past struggles?",
                "How do you discern between your own desires and God's will?",
                "When was a time God gave you peace in a stressful moment?",
                "How can we support each other in walking out our spiritual gifts?",
                "What's one way God has been refining your character lately?",
                "How can we use our relationship to glorify God even when apart?",
                "What do you think it looks like to put God first in a relationship?",
                "How do you experience God's love differently than a year ago?",
                "What's a prayer you've been hesitant to say out loud but want to share?",
                "How can we pray for each other more intentionally every day?",
                "What's a recent moment you felt God's presence very strongly?",
                "How do you handle doubt or spiritual dry seasons?",
                "What is one way we can worship God together from a distance?",
                "How has God taught you patience in your spiritual journey?",
                "What biblical character do you most relate to right now and why?",
                "How do you experience God's guidance in everyday decisions?",
                "What prayer or verse has been especially comforting during hard times?",
                "How can we celebrate God's work in our lives as a couple weekly?",
                "What is a spiritual goal you'd like us to achieve together this year?",
                "How do you personally study and meditate on scripture, and can we do it together?",
                "What is one way we can encourage each other's faith in small daily moments?",
                "How has your prayer life changed since we started dating?",
                "What is a miracle, big or small, you've witnessed recently?",
                "How can we remind each other of God's promises during stress or doubt?",
                "What's a habit or practice that has helped you grow closer to God?",
                "How do you feel God has prepared you for this season in your life?",
                "What is one fear you want to give to God and let Him carry?",
                "How can we serve others together in ways that honor God?",
                "What's a scripture we could write to encourage each other daily?",
                "How can we grow as spiritual partners in prayer, worship, and obedience?"
            ],
            "💬 Emotional Intimacy + Healing": [
                "What helps you feel emotionally safe with me?",
                "How do you usually respond when you're hurt or misunderstood?",
                "What's something that comforts you when you're having a rough day?",
                "How can I show more empathy when you're struggling?",
                "What do you need from me when you're feeling distant or disconnected?",
                "What past experience shaped how you handle emotions today?",
                "How can we be more honest about our needs without fear of judgment?",
                "What does emotional healing look like to you right now?",
                "How do you feel loved when you're having an off day?",
                "What's something that triggers your stress or insecurity, and how can I support you in it?",
                "How can we remind each other of truth when lies or fears creep in?",
                "What has God healed in your heart since we've been together?",
                "How can I help you feel seen and valued more deeply?",
                "What does \"feeling safe\" emotionally mean for you in a relationship?",
                "How do you prefer to receive comfort—through words, prayer, or presence?",
                "What's one childhood experience that still affects how you love today?",
                "How can we better handle misunderstandings or miscommunication?",
                "What's a way we can grow in emotional maturity together?",
                "What are some emotional boundaries that help you feel secure?",
                "What does forgiveness look like for you when you're hurt?",
                "How can we keep a soft heart toward each other even when frustrated?",
                "What emotion is hardest for you to express, and why?",
                "What helps you come back to peace when you feel overwhelmed?",
                "How can I pray for your emotional healing right now?",
                "How has God helped you overcome past emotional wounds?",
                "What does vulnerability look like for you, and what makes it easier?",
                "How can we create a \"judgment-free\" space when we share hard things?",
                "What's something you're learning to let go of emotionally?",
                "When do you feel most emotionally connected to me?",
                "How can we remind each other of our worth when we forget?",
                "What's one fear about love or commitment that you're still healing from?",
                "How can we respond with grace instead of reacting when we're upset?",
                "What helps you feel reassured of my love during conflict or distance?",
                "What's one way we can protect our peace as a couple?",
                "How can I show you more patience when you're processing something heavy?",
                "What do you need most from me when you're anxious or worried?",
                "How can we remind each other that healing is a journey, not a race?",
                "What helps you open up emotionally and share what's really on your heart?",
                "How can we let God lead our emotional healing process together?",
                "What does unconditional love look like to you — from God, and from me?"
            ],
            "🕊️ Communication + Conflict": [
                "What helps you feel heard and understood in a conversation?",
                "When conflict happens, what's the best way for me to approach you?",
                "What makes it hard for you to open up sometimes?",
                "How do you usually respond when you feel misunderstood?",
                "What's a healthy way we can take breaks during heated moments?",
                "How can we make our communication more gentle but still honest?",
                "What are some words or tones that feel triggering or discouraging for you?",
                "How can I make it easier for you to express your needs?",
                "What's something I can say or do that helps you feel reassured after conflict?",
                "How can we both listen better when we disagree?",
                "What helps you feel emotionally safe during hard conversations?",
                "How can we make sure we're addressing issues quickly instead of letting them build up?",
                "What's something you appreciate about how I communicate?",
                "How do you usually process your emotions before bringing them up?",
                "What's a communication habit we could both improve on?",
                "How can we remind each other that we're on the same team during conflict?",
                "What does \"speaking the truth in love\" look like to you?",
                "How can I respond with more patience when you're upset?",
                "How can we show grace even when one of us messes up or says something wrong?",
                "What helps you calm down when emotions feel high?",
                "How do you prefer to handle disagreements — in the moment or after cooling off?",
                "What's a phrase or response that instantly helps you feel at ease?",
                "How can we make space to talk about our expectations openly?",
                "How do you usually feel after we resolve conflict?",
                "What's one thing I could say differently that would help communication flow better?",
                "How do you feel God wants us to handle disagreement as a couple?",
                "How can we invite God into our communication more intentionally?",
                "What do you think we've learned about each other through past conflicts?",
                "How can we avoid miscommunication when we text or FaceTime?",
                "What's one thing I do that makes you feel truly listened to?",
                "What does humility look like for you in a disagreement?",
                "How can I better express my appreciation when you communicate well?",
                "How do you prefer to express your love or apology after an argument?",
                "How can we practice active listening — not just waiting to respond?",
                "What's one phrase or question that helps you open up when you're quiet?",
                "How do you feel we've grown in communication since the beginning?",
                "What does it look like to resolve conflict in a way that honors God?",
                "What's one area of communication where we can give each other more grace?",
                "How can I be more intentional in understanding your perspective?",
                "How do we make sure we always leave conversations with peace, not tension?"
            ],
            "🌱 Discovering God's Purpose for Us": [
                "Why do we believe God brought us together?",
                "What unique gifts or qualities do we each bring into this relationship?",
                "How do our individual callings complement each other?",
                "What moments have confirmed that God's hand is on our relationship?",
                "In what ways do we want our relationship to reflect Christ to others?",
                "What are some dreams or visions we've each had for our future that align with Kingdom purpose?",
                "How do we feel the Holy Spirit uses us together to impact others?",
                "What's one area we both feel called to serve in (church, community, creative work, etc.)?",
                "How do we define \"purpose\" as a couple — and is it centered on God or ourselves?",
                "How can we keep God at the center of our purpose together?"
            ],
            "🔥 Strengthening Our Individual Callings": [
                "How can we better support each other's personal callings and passions?",
                "What does it look like to celebrate, not compete with, each other's gifts?",
                "How do we balance being a team while still walking out individual assignments from God?",
                "What fears or insecurities hold us back from fully walking in our callings?",
                "How can we pray over each other's dreams and goals more intentionally?",
                "How do we respond when one of us feels \"stuck\" or uncertain in our purpose?",
                "What's one way we can encourage each other when discouragement or comparison hits?",
                "What would it look like to truly believe we're both chosen and anointed for different things?",
                "How can we create more space for each other to grow spiritually and creatively?",
                "How can we protect our time and energy so we don't burn out while serving?"
            ],
            "🌍 Building a Kingdom Vision Together": [
                "What kind of legacy do we want to leave behind as a couple?",
                "How can we use our relationship to point others to Jesus?",
                "What are some ways we can serve together — whether in ministry, business, or community?",
                "What kind of atmosphere do we want our future home or marriage to carry?",
                "How can we steward our finances, resources, and time to honor God's purpose for us?",
                "If God gave us a shared mission, what do we think it would be?",
                "How can we prepare our hearts now for the kind of purpose-driven marriage we desire?",
                "What would it look like to dream with God, not just for ourselves?",
                "How do we want to show up as a couple in our church or community?",
                "How can we ensure that our goals align with Kingdom values and not worldly success?"
            ],
            "💖 Surrender, Obedience + Trust": [
                "How can we surrender our plans and timelines to God together?",
                "What does obedience look like for us in this season of our relationship?",
                "How can we seek God for direction when we feel uncertain about our next steps?",
                "How can we make prayer and discernment part of every major decision we make together?",
                "How can we remind each other that purpose is more about who we become than what we do?",
                "How can we stay grounded in faith when we don't see the full picture yet?",
                "How can we use this season of waiting or distance to prepare for what's ahead?",
                "What boundaries or habits help us stay focused on God's will over our own desires?",
                "How do we want to handle it when one of us feels called in a direction that stretches our comfort zone?",
                "What do we believe God wants to do through our love story for His glory?"
            ],
            "🌿 Understanding Conflict": [
                "How do you usually feel when we disagree, and why?",
                "What triggers your defensiveness in arguments?",
                "How can I approach conflict in a way that makes you feel safe?",
                "When you're upset, what helps you calm down before we talk?",
                "How do you prefer to process hurt — immediately or with time?",
                "What's one thing I could do differently during disagreements to show love?",
                "How do past experiences affect how we handle conflict today?",
                "When do you feel most heard during a disagreement?",
                "How can we identify patterns in our conflicts before they escalate?",
                "What role does pride play in how we argue or forgive?"
            ],
            "💖 Emotional Healing Together": [
                "What past wounds do I need to understand better to love you fully?",
                "How can we create space to share pain without fear of judgment?",
                "What hurts do we need to pray over together right now?",
                "How do we know when we've truly healed from an argument or hurt?",
                "What is one way we can practice patience with each other's emotional triggers?",
                "How can we help each other release past hurts that affect our relationship?",
                "What's one thing we can celebrate about how far we've come in emotional growth?",
                "How can we stay mindful of each other's feelings during disagreements?",
                "What spiritual practices help us heal together (prayer, fasting, worship, scripture)?",
                "How can we remind each other that God is bigger than our mistakes?"
            ],
            "🌊 Forgiveness & Grace": [
                "How can we forgive faster without holding onto resentment?",
                "What does forgiveness feel like for you, and how can I honor that?",
                "How can we show grace when one of us repeats a mistake?",
                "What is one hurt I can release to God today for the sake of our relationship?",
                "How do we prevent small misunderstandings from becoming major conflicts?",
                "How can we practice humility when admitting we were wrong?",
                "What does \"extending mercy\" look like in our day-to-day life together?",
                "How can we avoid bringing past arguments into current discussions?",
                "How do we rebuild trust after being hurt?",
                "What scripture or prayer reminds us to forgive one another?"
            ],
            "🌟 Growing Through Challenges": [
                "How can conflict strengthen our relationship instead of weaken it?",
                "What lessons have we learned about each other through hard seasons?",
                "How do we balance truth-telling and kindness in disagreements?",
                "What role does prayer play in resolving tension between us?",
                "How can we identify the root cause of repeated conflicts?",
                "How do we ensure accountability without blame?",
                "How can we celebrate breakthroughs in communication or forgiveness?",
                "What practices help us restore peace after conflict (worship, journaling, scripture, prayer)?",
                "How can we honor each other's feelings even when we don't fully understand them?",
                "What is one area we can intentionally grow in forgiveness over the next month?"
            ],
            "🌿 Building Trust": [
                "What helps you feel most secure in our relationship?",
                "How do you usually know when you can trust someone fully?",
                "What actions or words make you feel unsafe emotionally?",
                "How can we rebuild trust if it's ever shaken?",
                "What small acts of faithfulness make a big difference to you?",
                "How can I prove reliability to you in practical ways?",
                "When have you felt the deepest trust with me, and why?",
                "How do we balance independence and trust in our relationship?",
                "What fears do we need to give to God to grow trust?",
                "How can we intentionally celebrate each act of loyalty or honesty?"
            ],
            "💖 Creating Emotional Safety": [
                "What behaviors help you feel comfortable sharing your heart?",
                "How can I create space for you to speak without interruption or judgment?",
                "How do we respond when one of us shares something vulnerable?",
                "What is a safe word or phrase we could use to pause tense moments?",
                "How can we make our disagreements feel safe instead of threatening?",
                "What boundaries help you feel respected and secure?",
                "How can we remind each other that our hearts are sacred?",
                "What daily practices help cultivate emotional safety between us?",
                "How do we handle criticism in a way that strengthens rather than harms?",
                "How can we build a habit of listening with empathy first, advice second?"
            ],
            "🌊 Practicing Vulnerability": [
                "What's a fear you've never shared with me but want to?",
                "How can we be honest about feelings without fear of hurting each other?",
                "What makes it easy for you to open up emotionally?",
                "How do we create space for sharing dreams, fears, and insecurities?",
                "What's one small vulnerability I can practice this week with you?",
                "How can we support each other when opening up feels scary?",
                "What past experiences make vulnerability difficult for you?",
                "How can we honor God while being fully transparent with each other?",
                "How does vulnerability strengthen our emotional and spiritual connection?",
                "How can we encourage each other to be brave in sharing inner thoughts?"
            ],
            "🌟 Deepening Connection Through Trust": [
                "How can we remind each other that God is the ultimate protector of our hearts?",
                "What role does faith play in feeling secure with each other?",
                "How can we celebrate trust milestones in our relationship?",
                "What habits can help us maintain transparency and honesty daily?",
                "How can we better support each other when one of us is anxious or fearful?",
                "How do we balance personal boundaries with openness?",
                "How can we reflect Christ's love in the ways we trust one another?",
                "What is one way I can show you that your heart is safe with me?",
                "How do we respond to mistakes or misunderstandings in a way that builds trust?",
                "How can we continue to grow in vulnerability and intimacy as our relationship deepens?"
            ],
            "🌿 Gratitude for Each Other": [
                "What is one thing you're grateful for about me today?",
                "When have I made you feel truly appreciated recently?",
                "What small gestures of love do you notice but might not say out loud?",
                "How do we celebrate each other's victories, big or small?",
                "What is a quality in me that you are thankful God placed in your life?",
                "How can we express gratitude to each other daily?",
                "What's one memory of us that fills you with gratitude?",
                "How has our relationship helped you grow closer to God?",
                "What blessings in our relationship do we often take for granted?",
                "How do you feel when I notice and affirm your efforts?"
            ],
            "💖 Joy in the Everyday": [
                "What's a moment this week that made you laugh or smile because of me?",
                "How can we create more moments of joy even during stressful times?",
                "What small things in our relationship bring you the most happiness?",
                "When do you feel carefree and light-hearted with me?",
                "How can we infuse fun into routine activities together?",
                "What's one thing we can do this week just for fun?",
                "How do you feel when we celebrate life's little wins together?",
                "What is a favorite inside joke or shared memory that always brings joy?",
                "How does laughter and play strengthen our connection?",
                "How can we remind each other to enjoy the present moment more?"
            ],
            "🌊 Adventures + Fun Together": [
                "What's one fun date idea we've always wanted to try?",
                "How can we incorporate adventure into our weekends or evenings?",
                "What hobbies or activities can we explore together to grow closer?",
                "How do we support each other's playful, creative sides?",
                "What's a new skill or experience we could try as a couple?",
                "How do shared experiences strengthen our bond?",
                "What's one spontaneous thing we could do to make each other smile?",
                "How can we celebrate milestones in fun, meaningful ways?",
                "What's your favorite way to make me laugh or smile?",
                "How can we keep fun and play alive even when life feels heavy?"
            ],
            "🌟 Gratitude + Joy in God Together": [
                "What blessings in our relationship remind you of God's goodness?",
                "How can we thank God together for our love and connection?",
                "What's a favorite scripture that brings joy to our hearts as a couple?",
                "How can we use moments of laughter to reflect God's joy in our relationship?",
                "What's one way we can serve others together that will also bring us joy?",
                "How can we celebrate answered prayers as a couple?",
                "What spiritual victories or breakthroughs have made you grateful recently?",
                "How can we worship God together in playful or creative ways?",
                "What's one thing we can do daily to cultivate gratitude and joy as a couple?",
                "How do shared smiles, laughter, and fun remind us of God's love?"
            ],
            "🌿 Personal Growth": [
                "What's one area of your life where you've grown spiritually in the last year?",
                "How have your past experiences shaped who you are today?",
                "What is a habit or mindset you want to improve for God's glory?",
                "How do you know when you're truly aligning your actions with your values?",
                "What fear or insecurity are you learning to trust God with?",
                "How can I encourage you in your personal growth journey?",
                "When do you feel most proud of yourself spiritually or emotionally?",
                "How do you celebrate small wins in your growth?",
                "What scripture reminds you to keep pressing forward in personal development?",
                "How has God used challenges to refine your character?"
            ],
            "💖 Growth as a Couple": [
                "What is one lesson we've learned together this year that has strengthened our bond?",
                "How can we support each other in becoming more Christlike?",
                "What patterns in our relationship do we want to grow out of?",
                "How can we challenge each other to step out of comfort zones for growth?",
                "What does accountability look like in our relationship?",
                "How do we handle constructive feedback in a loving way?",
                "How can we celebrate growth milestones as a couple?",
                "What spiritual practices can we adopt to grow closer together?",
                "How do we ensure our individual growth doesn't create distance but strengthens connection?",
                "What is one shared goal we can pursue for mutual growth this year?"
            ],
            "🌊 Self-Awareness + Reflection": [
                "What are my triggers, and how can I communicate them to you better?",
                "How can I be more mindful of my words and actions toward you?",
                "What strengths do I bring to our relationship that I sometimes take for granted?",
                "What areas of myself do I still need to surrender fully to God?",
                "How do I respond to stress, and how can you help me navigate it?",
                "What are my blind spots in our relationship, and how can we address them?",
                "How can I recognize and celebrate your growth without comparison?",
                "What does emotional maturity look like in me, and how can I keep improving?",
                "How do I want to show up differently for you in the next season of our relationship?",
                "What habits help me stay self-aware and Spirit-led daily?"
            ],
            "🌟 Accountability + Vision": [
                "How can we hold each other accountable without shame or judgment?",
                "What's one boundary we can set to protect our growth individually and as a couple?",
                "How do we recognize when we've fallen into old patterns and course-correct?",
                "How can we ensure God remains central in our growth journey?",
                "What goals can we set to grow spiritually, emotionally, and relationally together?",
                "How do we encourage vulnerability while still fostering self-awareness?",
                "How can we reflect on our progress regularly without discouragement?",
                "What legacy do we want to leave as individuals and as a couple?",
                "How can we celebrate progress, not just perfection?",
                "What steps can we take together to ensure we're always growing closer to God and each other?"
            ]
        };

        // Date Night Questions (250 unique questions - different from daily reflections)
        const dateNightQuestions = [
            "What's the most romantic gesture someone could do for you?",
            "If you could relive any day from our relationship, which would it be?",
            "What's your idea of the perfect weekend getaway together?",
            "What song always reminds you of us?",
            "If we opened a business together, what would it be?",
            "What's something silly that always makes you think of me?",
            "If you could give our relationship a theme song, what would it be?",
            "What's your favorite way to be woken up in the morning?",
            "If we could live anywhere in the world, where would you choose?",
            "What's the best advice about love you've ever received?",
            "If you could plan a surprise for me, what would it involve?",
            "What's your favorite thing to do on a rainy day together?",
            "If we could master any skill together, what would it be?",
            "What's something you've always wanted to ask me but haven't?",
            "If our love story was a movie, what genre would it be?",
            "What's your favorite way to celebrate small victories?",
            "If you could change one thing about how we met, what would it be?",
            "What's the most adventurous thing you'd like us to try?",
            "If we could have any superpower as a team, what would it be?",
            "What's your favorite thing about the way I laugh?",
            "If you could describe our relationship in three words, what would they be?",
            "What's something you hope we never stop doing together?",
            "If we could time travel together, what era would you choose?",
            "What's your favorite thing about the way we dance together?",
            "If you could ask God one question about our future, what would it be?",
            "What's the most meaningful gift you've ever received from anyone?",
            "If we could have a conversation with our future selves, what would you ask?",
            "What's your favorite thing about how we make decisions together?",
            "If you could bottle up a feeling from our relationship, which would it be?",
            "What's something you're excited to experience with me for the first time?",
            "If we could have a theme for our relationship, what would it be?",
            "What's your favorite way to show someone you care about them?",
            "What's something about me that still surprises you?",
            "If we could create a new holiday together, what would we celebrate?",
            "What's your favorite thing about the way we complement each other?",
            "If you could write a letter to us five years from now, what would it say?",
            "What's something you want to be brave enough to try with me?",
            "If we could have any animal as a pet together, what would it be?",
            "What's your favorite thing about the way we handle disagreements?",
            "If you could plan the perfect birthday for me, what would it include?",
            "What's something you admire about how I treat other people?",
            "If we could learn any language together, which would you choose?",
            "What's your favorite thing about the way we pray together?",
            "If you could give me a new nickname, what would it be?",
            "What's something you want to accomplish before we're married?",
            "What biblical story about love inspires you most for our relationship?",
            "What's your favorite thing about the way we encourage each other?",
            "If you could design our dream house together, what's the first room you'd plan?",
            "What's something you love about my family?",
            "If we could volunteer anywhere together, where would it be?",
            "What's your favorite thing about the way we worship together?",
            "If you could give me any talent or ability, what would it be?",
            "What's something you want to create or build together someday?",
            "If we could have any job together, what would it be?",
            "What's your favorite thing about the way we make each other laugh?",
            "If you could plan our perfect anniversary celebration, what would it be?",
            "What's something you appreciate about how I handle stress?",
            "If we could take a class together, what would you want to learn?",
            "What's your favorite thing about the way we share our thoughts?",
            "If you could give our relationship a motto, what would it be?",
            "What's something you want to experience in different seasons together?",
            "If we could have any mode of transportation, what would you choose?",
            "What's your favorite thing about the way we support each other's dreams?",
            "What's something you love about the way we spend quiet time together?",
            "If we could adopt any tradition from another culture, what would it be?",
            "What's your favorite thing about the way we handle surprises?",
            "If you could give me one piece of clothing to wear forever, what would it be?",
            "What's something you want to be known for as a team?",
            "If we could have any view from our window, what would it be?",
            "What's your favorite thing about the way we share responsibilities?",
            "If you could plan a perfect day that costs no money, what would we do?",
            "What's something you love about the way we text each other?",
            "What kind of ceremony would make our wedding feel most sacred to you?",
            "What's your favorite thing about the way we handle change together?",
            "If you could give me any experience as a gift, what would it be?",
            "What's something you appreciate about how I show affection?",
            "If we could have any weather every day, what would you choose?",
            "What's your favorite thing about the way we plan for the future?",
            "If you could ask God to bless one aspect of our relationship, what would it be?",
            "What's something you love about the way we celebrate each other?",
            "If we could have any first dance song, what would it be?",
            "What's your favorite thing about the way we handle money together?",
            "If you could give me any book to read, what would it be and why?",
            "What's something you want to always remember about this season of our relationship?",
            "What's your favorite thing about the way we make memories together?",
            "If you could change anything about our first date, what would it be?",
            "What's something you love about the way we include God in our relationship?",
            "If we could have any honeymoon destination, where would you want to go?",
            "What's your favorite thing about the way we balance independence and togetherness?",
            "If you could give me any compliment right now, what would it be?",
            "What's something you want to improve about yourself for our relationship?",
            "What activity would make the perfect regular date night for us?",
            "What's your favorite thing about the way we handle each other's families?",
            "If you could ask me to change one small habit, what would it be?",
            "What's something you love about the way we share our faith?",
            "If we could have any wedding venue, where would it be?",
            "What's your favorite thing about the way we motivate each other?",
            "If you could give me any advice right now, what would it be?",
            "What's something you want to always be intentional about in our relationship?",
            "What's your favorite thing about the way we handle technology in our relationship?",
            "If you could plan our perfect engagement story, what would happen?",
            "What's something you love about the way we share our feelings?",
            "If we could have any number of children, how many would you want?",
            "What's your favorite thing about the way we handle distance or time apart?",
            "If you could give our future children one piece of advice about love, what would it be?",
            "What's something you appreciate about how I listen to you?",
            "If we could have any wedding theme, what would it be?",
            "What's your favorite thing about the way we handle each other's friends?",
            "If you could plan our perfect 'just because' date, what would it be?",
            "What's something you love about the way we share our goals?",
            "Which book of the Bible would you most want us to study together?",
            "What's your favorite thing about the way we handle conflict resolution?",
            "If you could give me any experience from your childhood, what would it be?",
            "What's something you want to always prioritize in our relationship?",
            "If we could start any ministry together, what would it focus on?",
            "What's your favorite thing about the way we show gratitude to each other?",
            "If you could ask me any question and get a completely honest answer, what would it be?",
            "What's something you love about the way we handle social situations together?",
            "What would make the perfect retreat experience for us?",
            "What's your favorite thing about the way we share our struggles?",
            "If you could give me any talent for one day, what would it be?",
            "What's something you appreciate about how I make you feel beautiful/handsome?",
            "What's your favorite thing about the way we handle each other's emotions?",
            "If you could plan our perfect lazy Sunday, what would it look like?",
            "What's something you love about the way we share our victories?",
            "What hobby would you love for us to explore together?",
            "What's your favorite thing about the way we handle peer pressure together?",
            "If you could give me any memory from before we met, what would it be?",
            "What's something you want to always be curious about regarding each other?",
            "Where would you most want us to serve together on a mission trip?",
            "What's your favorite thing about the way we handle expectations?",
            "If you could ask me to start any new habit, what would it be?",
            "What's something you love about the way we share our fears?",
            "What kind of fitness journey would you want us to take together?",
            "What's your favorite thing about the way we handle criticism from others?",
            "If you could give me any superpower for our relationship, what would it be?",
            "What's something you appreciate about how I make you feel safe?",
            "What creative project would you love for us to work on together?",
            "What's your favorite thing about the way we handle each other's past?",
            "If you could plan our perfect road trip, where would we go?",
            "What's something you love about the way we share our hopes?",
            "What games would make our perfect game night tradition?",
            "What's your favorite thing about the way we handle jealousy or insecurity?",
            "If you could give me any piece of wisdom, what would it be?",
            "What's something you want to always be patient about with each other?",
            "What would you love for us to cook together regularly?",
            "What's your favorite thing about the way we handle each other's growth?",
            "If you could ask me to never change one thing about myself, what would it be?",
            "What's something you love about the way we share our passions?",
            "What would you want us to read together as a tradition?",
            "What's your favorite thing about the way we handle forgiveness?",
            "If you could give me any experience to help me understand you better, what would it be?",
            "What's something you appreciate about how I make you feel valued?",
            "What service project would you love for us to do together?",
            "What's your favorite thing about the way we handle each other's weaknesses?",
            "If you could plan our perfect winter evening together, what would it include?",
            "What's something you love about the way we share our testimonies?",
            "What would be the perfect learning experience for us to share?",
            "What's your favorite thing about the way we handle pressure from family or friends?",
            "If you could give me any gift that money can't buy, what would it be?",
            "What's something you want to always be gracious about with each other?",
            "What adventure sport would you want us to try together?",
            "What's your favorite thing about the way we handle each other's mistakes?",
            "If you could ask me to always remember one thing about you, what would it be?",
            "What's something you love about the way we share our worship?",
            "What creative outlet would you want us to explore together?",
            "What's your favorite thing about the way we handle disappointment together?",
            "If you could give me any skill to better love you, what would it be?",
            "What's something you appreciate about how I make you feel understood?",
            "What travel tradition would you want us to start?",
            "What's your favorite thing about the way we handle each other's success?",
            "If you could plan our perfect summer day together, what would it include?",
            "What's something you love about the way we share our prayers?",
            "What fitness goal would you want us to pursue together?",
            "What's your favorite thing about the way we handle uncertainty together?",
            "If you could give me any characteristic to strengthen our relationship, what would it be?",
            "What's something you want to always be understanding about with each other?",
            "How would you want us to express our creativity together?",
            "What's your favorite thing about the way we handle each other's boundaries?",
            "If you could ask me to always notice one thing about you, what would it be?",
            "What's something you love about the way we share our blessings?",
            "What intellectual pursuit would you want us to explore together?",
            "What's your favorite thing about the way we handle life's surprises together?",
            "If you could give me any mindset to improve our relationship, what would it be?",
            "What's something you appreciate about how I make you feel cherished?",
            "What spiritual discipline would you want us to practice together?",
            "What's your favorite thing about the way we handle each other's dreams?",
            "If you could plan our perfect spring day together, what would it include?",
            "What's something you love about the way we share our gratitude?",
            "How would you want us to be involved in our community together?",
            "What's your favorite thing about the way we handle growing closer to God together?",
            "If you could give me any perspective to deepen our love, what would it be?",
            "What's something you want to always be intentional about celebrating in each other?",
            "What legacy project would you want us to work on together?",
            "What's your favorite thing about the way we handle preparing for marriage together?",
            "If you could ask me to always prioritize one thing in our relationship, what would it be?",
            "What's something you love about the way we share our vision for the future?",
            "How would you want us to mentor others in their relationships?",
            "What's your favorite thing about the way we handle trusting God with our relationship?",
            "If you could give me any heart posture to honor our love, what would it be?",
            "What's something you appreciate about how I make you feel like we're a team?",
            "What kingdom impact would you want our relationship to have?",
            "What's your favorite thing about the way we handle surrendering our relationship to God?",
            "If you could plan our perfect fall day together, what would it include?",
            "What's something you love about the way we share our commitment to purity?",
            "What discipleship experience would you want us to share?",
            "What's your favorite thing about the way we handle seeking God's will together?",
            "If you could give me any spiritual gift to bless our relationship, what would it be?",
            "What's something you want to always be faithful about in our love story?",
            "How would you want us to worship God together?",
            "What's your favorite thing about the way we handle honoring God with our relationship?",
            "If you could ask me to always trust God for one thing about us, what would it be?",
            "What's something you love about the way we share our covenant with each other and God?",
            "What would you want our prayer focus to be as a team?",
            "What's your favorite thing about the way we handle building our relationship on Christ?",
            "If you could give me any biblical characteristic to strengthen our bond, what would it be?",
            "What's something you appreciate about how I make you feel like we're walking with God together?",
            "What ministry calling would you want us to share?",
            "What's your favorite thing about the way we handle making our love a testimony of God's goodness?",
            "If you could ask me to always remember one truth about God's design for our relationship, what would it be?",
            "What's something you love about the way we share our desire to glorify God through our love?",
            "What eternal perspective would you want our relationship to focus on?",
            "What's your favorite thing about the way we handle preparing our hearts for the marriage God has planned for us?"
        ];

        // App State
        let currentUser = null;
        let coupleId = null;
        let partnerConnected = false;
        let currentTab = 'daily';
        let todaysQuestion = null;
        let reflections = [];
        let currentDateCardIndex = 0;
        let shuffledDateQuestions = [];
        let partnerReflectionListener = null;

        // Initialize App
        function initializeApp() {
            // Load saved login credentials if remember me was checked
            loadSavedCredentials();
            
            // Check authentication state
            auth.onAuthStateChanged(user => {
                if (user) {
                    currentUser = user;
                    hideLoginScreen();
                    loadUserData();
                    generateCoupleId();
                    loadTodaysQuestion();
                    loadDateNightQuestions();
                    loadReflections();
                    updateAllCounters();
                    updateDateHeader();
                    updateWeeklyHeader();
                    updateMonthlyHeader();
                    loadWeeklyReflections();
                    loadMonthlyGoals();
                    checkMobileView();
                    loadProfilePicture();
                    setupRealtimeSync();
                } else {
                    showLoginScreen();
                }
            });
        }

        // Remember Me Functionality
        function loadSavedCredentials() {
            const savedEmail = localStorage.getItem('rememberedEmail');
            const savedPassword = localStorage.getItem('rememberedPassword');
            const rememberMe = localStorage.getItem('rememberMe') === 'true';
            
            if (rememberMe && savedEmail && savedPassword) {
                document.getElementById('loginEmail').value = savedEmail;
                document.getElementById('loginPassword').value = savedPassword;
                document.getElementById('rememberMe').checked = true;
            }
        }

        function saveCredentials(email, password) {
            const rememberMe = document.getElementById('rememberMe').checked;
            
            if (rememberMe) {
                localStorage.setItem('rememberedEmail', email);
                localStorage.setItem('rememberedPassword', password);
                localStorage.setItem('rememberMe', 'true');
            } else {
                localStorage.removeItem('rememberedEmail');
                localStorage.removeItem('rememberedPassword');
                localStorage.removeItem('rememberMe');
            }
        }

        // Authentication Management
        function showLoginScreen() {
            document.getElementById('loginScreen').style.display = 'flex';
        }

        function hideLoginScreen() {
            document.getElementById('loginScreen').style.display = 'none';
        }

        function showLoginForm() {
            document.getElementById('loginForm').style.display = 'block';
            document.getElementById('signUpForm').style.display = 'none';
            document.getElementById('forgotPasswordForm').style.display = 'none';
            hideAuthMessage();
        }

        function showSignUpForm() {
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('signUpForm').style.display = 'block';
            document.getElementById('forgotPasswordForm').style.display = 'none';
            hideAuthMessage();
        }

        function showForgotPassword() {
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('signUpForm').style.display = 'none';
            document.getElementById('forgotPasswordForm').style.display = 'block';
            hideAuthMessage();
        }

        function showAuthMessage(message, isError = false) {
            const messageEl = document.getElementById('authMessage');
            messageEl.textContent = message;
            messageEl.style.display = 'block';
            messageEl.style.backgroundColor = isError ? '#fed7d7' : '#f0fff4';
            messageEl.style.color = isError ? '#c53030' : '#38a169';
            messageEl.style.border = isError ? '1px solid #feb2b2' : '1px solid #9ae6b4';
        }

        function hideAuthMessage() {
            document.getElementById('authMessage').style.display = 'none';
        }

        function signInUser() {
            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value;

            if (!email || !password) {
                showAuthMessage('Please enter both email and password.', true);
                return;
            }

            showAuthMessage('Signing in...');

            auth.signInWithEmailAndPassword(email, password)
                .then(userCredential => {
                    // Save credentials if remember me is checked
                    saveCredentials(email, password);
                    showAuthMessage('Successfully signed in! Loading your data...');
                    
                    // Force hide login screen after successful login
                    setTimeout(() => {
                        hideLoginScreen();
                    }, 1000);
                })
                .catch(error => {
                    console.error('Login error:', error);
                    let errorMessage = 'Sign in failed. Please try again.';
                    if (error.code === 'auth/user-not-found') {
                        errorMessage = 'No account found with this email.';
                    } else if (error.code === 'auth/wrong-password' || error.code === 'auth/invalid-credential') {
                        errorMessage = 'Incorrect password.';
                    } else if (error.code === 'auth/invalid-email') {
                        errorMessage = 'Invalid email address.';
                    } else if (error.code === 'auth/too-many-requests') {
                        errorMessage = 'Too many failed attempts. Please try again later.';
                    }
                    showAuthMessage(errorMessage, true);
                });
        }

        function signUpUser() {
            const name = document.getElementById('signUpName').value.trim();
            const email = document.getElementById('signUpEmail').value.trim();
            const password = document.getElementById('signUpPassword').value;

            if (!name || !email || !password) {
                showAuthMessage('Please fill in all fields.', true);
                return;
            }

            if (password.length < 6) {
                showAuthMessage('Password must be at least 6 characters long.', true);
                return;
            }

            auth.createUserWithEmailAndPassword(email, password)
                .then(userCredential => {
                    // Update user profile with name
                    return userCredential.user.updateProfile({
                        displayName: name
                    });
                })
                .then(() => {
                    // Save user data to Firestore
                    return db.collection('users').doc(auth.currentUser.uid).set({
                        displayName: name,
                        email: email,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                })
                .then(() => {
                    showAuthMessage('Account created successfully! Welcome to Kingdom Connection!');
                })
                .catch(error => {
                    let errorMessage = 'Account creation failed. Please try again.';
                    if (error.code === 'auth/email-already-in-use') {
                        errorMessage = 'An account with this email already exists.';
                    } else if (error.code === 'auth/invalid-email') {
                        errorMessage = 'Invalid email address.';
                    } else if (error.code === 'auth/weak-password') {
                        errorMessage = 'Password is too weak. Please choose a stronger password.';
                    }
                    showAuthMessage(errorMessage, true);
                });
        }

        function resetPassword() {
            const email = document.getElementById('resetEmail').value.trim();

            if (!email) {
                showAuthMessage('Please enter your email address.', true);
                return;
            }

            auth.sendPasswordResetEmail(email)
                .then(() => {
                    showAuthMessage('Password reset email sent! Check your inbox.');
                })
                .catch(error => {
                    let errorMessage = 'Failed to send reset email. Please try again.';
                    if (error.code === 'auth/user-not-found') {
                        errorMessage = 'No account found with this email address.';
                    } else if (error.code === 'auth/invalid-email') {
                        errorMessage = 'Invalid email address.';
                    }
                    showAuthMessage(errorMessage, true);
                });
        }

        function signOutUser() {
            auth.signOut().then(() => {
                localStorage.clear();
                showLoginScreen();
            });
        }

        // Profile Picture Management
        function handleProfilePicChange() {
            const file = document.getElementById('profilePicInput').files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const imageData = e.target.result;
                localStorage.setItem('profilePicture', imageData);
                updateProfilePicture(imageData);
            };
            reader.readAsDataURL(file);
        }

        function updateProfilePicture(imageData) {
            const profilePic = document.getElementById('profilePic');
            const profilePicLarge = document.getElementById('profilePicLarge');
            
            profilePic.innerHTML = `<img src="${imageData}" alt="Profile">`;
            profilePicLarge.innerHTML = `<img src="${imageData}" alt="Profile">`;
            
            // Update all reflection profile pictures
            const reflectionPics = [
                'yourProfilePicReflection',
                'yourProfilePicWeekly', 
                'yourProfilePicMonthly'
            ];
            
            reflectionPics.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.innerHTML = `<img src="${imageData}" alt="Profile">`;
                }
            });
        }

        function removeProfilePic() {
            localStorage.removeItem('profilePicture');
            loadProfilePicture();
        }

        function loadProfilePicture() {
            const savedPic = localStorage.getItem('profilePicture');
            const savedName = localStorage.getItem('displayName');
            
            if (savedPic) {
                updateProfilePicture(savedPic);
            } else if (savedName) {
                const initial = savedName.charAt(0).toUpperCase();
                document.getElementById('profileInitial').textContent = initial;
                document.getElementById('profileInitialLarge').textContent = initial;
                
                // Update all reflection initials
                const reflectionInitials = [
                    'yourInitialReflection',
                    'yourInitialWeekly',
                    'yourInitialMonthly'
                ];
                
                reflectionInitials.forEach(id => {
                    const element = document.getElementById(id);
                    if (element) {
                        element.textContent = initial;
                    }
                });
            }
        }

        function updateProfileDisplays() {
            if (!currentUser) return;
            
            const name = currentUser.displayName || currentUser.email;
            document.getElementById('yourName').textContent = name;
            document.getElementById('yourNameWeekly').textContent = name;
            document.getElementById('yourNameMonthly').textContent = name;
            
            const initial = name.charAt(0).toUpperCase();
            document.getElementById('profileInitial').textContent = initial;
            document.getElementById('profileInitialLarge').textContent = initial;
            
            // Update all reflection initials
            const reflectionInitials = [
                'yourInitialReflection',
                'yourInitialWeekly',
                'yourInitialMonthly'
            ];
            
            reflectionInitials.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.textContent = initial;
                }
            });
        }

        // Tab Management
        function switchTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            
            // Update nav tabs
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            const navTab = document.querySelector(`[onclick="switchTab('${tabName}')"]`);
            if (navTab) navTab.classList.add('active');
            
            // Update mobile nav
            document.querySelectorAll('.mobile-nav-item').forEach(item => {
                item.classList.remove('active');
            });
            const mobileNavItem = document.querySelector(`.mobile-nav-item[onclick="switchTab('${tabName}')"]`);
            if (mobileNavItem) mobileNavItem.classList.add('active');
            
            currentTab = tabName;
        }

        // Daily Question Management
        function loadTodaysQuestion() {
            const today = new Date();
            const dateString = today.getFullYear() + '-' + 
                             String(today.getMonth() + 1).padStart(2, '0') + '-' + 
                             String(today.getDate()).padStart(2, '0');
            const savedQuestion = localStorage.getItem(`question_${dateString}`);
            
            if (savedQuestion) {
                todaysQuestion = JSON.parse(savedQuestion);
            } else {
                todaysQuestion = generateDailyQuestion();
                localStorage.setItem(`question_${dateString}`, JSON.stringify(todaysQuestion));
            }
            
            displayQuestion(todaysQuestion);
            loadTodaysReflections();
        }

        function generateDailyQuestion() {
            const categories = Object.keys(dailyQuestions);
            const today = new Date();
            
            // Create a consistent seed based on the date string (YYYY-MM-DD format)
            const dateString = today.getFullYear() + '-' + 
                             String(today.getMonth() + 1).padStart(2, '0') + '-' + 
                             String(today.getDate()).padStart(2, '0');
            
            // Simple hash function to convert date string to number
            let hash = 0;
            for (let i = 0; i < dateString.length; i++) {
                const char = dateString.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash; // Convert to 32-bit integer
            }
            
            // Use absolute value to ensure positive number
            const seed = Math.abs(hash);
            
            const categoryIndex = seed % categories.length;
            const category = categories[categoryIndex];
            
            const questions = dailyQuestions[category];
            const questionIndex = Math.floor(seed / categories.length) % questions.length;
            
            return {
                category: category,
                question: questions[questionIndex],
                date: dateString // Use consistent date format instead of toDateString()
            };
        }

        function displayQuestion(questionObj) {
            document.getElementById('categoryBadge').textContent = questionObj.category;
            document.getElementById('questionText').textContent = questionObj.question;
        }

        function skipQuestion() {
            const today = new Date().toDateString();
            localStorage.setItem(`skipped_${today}`, 'true');
            
            // Generate new question for tomorrow
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            const tomorrowQuestion = generateDailyQuestion();
            
            displayQuestion(tomorrowQuestion);
            document.getElementById('yourReflection').value = '';
            document.getElementById('partnerReflectionDisplay').innerHTML = 'Waiting for your partner\'s reflection...';
        }

        // Notification System
        function requestNotificationPermission() {
            if ('Notification' in window && Notification.permission === 'default') {
                Notification.requestPermission();
            }
        }

        function showNotification(title, body) {
            if ('Notification' in window && Notification.permission === 'granted') {
                new Notification(title, {
                    body: body,
                    icon: 'https://raw.githubusercontent.com/chanellejanae/kingdomconnection/main/logo.png',
                    badge: 'https://raw.githubusercontent.com/chanellejanae/kingdomconnection/main/logo.png'
                });
            }
        }

        // Reflection Management with Real-time Sync
        function saveYourReflection() {
            const reflectionText = document.getElementById('yourReflection').value.trim();
            
            if (!reflectionText) {
                showAuthMessage('Please write your reflection before saving.', true);
                return;
            }
            
            if (!currentUser) {
                showAuthMessage('Please sign in to save your reflection.', true);
                return;
            }
            
            const reflection = {
                id: Date.now(),
                date: new Date().toDateString(),
                category: todaysQuestion.category,
                question: todaysQuestion.question,
                reflection: reflectionText,
                userId: currentUser.uid,
                userEmail: currentUser.email,
                userName: currentUser.displayName || currentUser.email,
                coupleId: coupleId,
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            };
            
            // Save to Firebase for real-time sync
            saveReflectionToFirebase(reflection);
            
            // Record that question was answered for counters
            recordQuestionAnswered();
            
            showAuthMessage('Reflection saved successfully! 💕');
            loadReflections();
        }

        function loadTodaysReflections() {
            const today = new Date().toDateString();
            const savedReflection = localStorage.getItem(`reflection_${today}`);
            
            if (savedReflection) {
                const reflection = JSON.parse(savedReflection);
                document.getElementById('yourReflection').value = reflection.yourReflection || '';
            }
            
            // Load partner's reflection from Firebase
            if (coupleId) {
                loadPartnerReflection();
            }
        }

        function setupRealtimeSync() {
            if (!coupleId || !currentUser) return;
            
            // Request notification permission
            requestNotificationPermission();
            
            // Listen for partner's reflections
            const today = new Date().toDateString();
            let hasShownNotification = false;
            
            partnerReflectionListener = db.collection('reflections')
                .where('coupleId', '==', coupleId)
                .where('date', '==', today)
                .onSnapshot(snapshot => {
                    let partnerReflection = null;
                    let yourReflection = null;
                    
                    snapshot.forEach(doc => {
                        const data = doc.data();
                        if (data.userId === currentUser.uid) {
                            yourReflection = data.reflection;
                        } else {
                            partnerReflection = data;
                        }
                    });
                    
                    // Update your reflection if it exists
                    if (yourReflection) {
                        document.getElementById('yourReflection').value = yourReflection;
                    }
                    
                    // Update partner reflection display and show notification
                    if (partnerReflection) {
                        displayPartnerReflection(partnerReflection.reflection, partnerReflection.userName);
                        
                        // Show notification only once per day when partner completes reflection
                        if (!hasShownNotification) {
                            showNotification('💕 Partner Reflection Complete!', `${partnerReflection.userName} has shared their daily reflection with you.`);
                            hasShownNotification = true;
                        }
                    } else {
                        displayPartnerReflection(null);
                    }
                });
        }

        function loadPartnerReflection() {
            if (!coupleId || !currentUser) return;
            
            const today = new Date().toDateString();
            db.collection('reflections')
                .where('coupleId', '==', coupleId)
                .where('date', '==', today)
                .get()
                .then(querySnapshot => {
                    let partnerReflection = null;
                    let yourReflection = null;
                    
                    querySnapshot.forEach(doc => {
                        const data = doc.data();
                        if (data.userId === currentUser.uid) {
                            yourReflection = data.reflection;
                        } else {
                            partnerReflection = data;
                        }
                    });
                    
                    // Update your reflection if it exists
                    if (yourReflection) {
                        document.getElementById('yourReflection').value = yourReflection;
                    }
                    
                    // Update partner reflection display
                    if (partnerReflection) {
                        displayPartnerReflection(partnerReflection.reflection, partnerReflection.userName);
                    }
                });
        }

        function displayPartnerReflection(reflection, partnerName = 'Partner') {
            const display = document.getElementById('partnerReflectionDisplay');
            const partnerNameEl = document.getElementById('partnerName');
            const partnerInitialEl = document.getElementById('partnerInitialReflection');
            
            if (reflection) {
                display.innerHTML = reflection;
                display.style.fontStyle = 'normal';
                display.style.color = '#4a5568';
                document.getElementById('partnerStatus').className = 'online-indicator';
                partnerNameEl.textContent = partnerName;
                partnerInitialEl.textContent = partnerName.charAt(0).toUpperCase();
            } else {
                display.innerHTML = 'Waiting for your partner\'s reflection...';
                display.style.fontStyle = 'italic';
                display.style.color = '#718096';
                document.getElementById('partnerStatus').className = 'offline-indicator';
                partnerNameEl.textContent = 'Partner';
                partnerInitialEl.textContent = '👤';
            }
        }

        function saveReflectionToFirebase(reflection) {
            db.collection('reflections').add({
                ...reflection,
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            }).catch(error => {
                console.error('Error saving to Firebase:', error);
            });
        }

        function loadReflections() {
            const saved = localStorage.getItem('reflections');
            if (saved) {
                reflections = JSON.parse(saved);
            }
            
            displayReflections();
        }

        function displayReflections() {
            const container = document.getElementById('reflectionsList');
            
            if (reflections.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 3rem; color: #718096;">
                        <p>No reflections yet. Start your journey by answering today's question!</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = reflections.map(reflection => `
                <div class="reflection-item">
                    <div class="reflection-date">${new Date(reflection.date).toLocaleDateString()}</div>
                    <div class="reflection-question">${reflection.question}</div>
                    <div class="partner-answers">
                        <div class="partner-answer">
                            <strong>You:</strong><br>
                            ${reflection.yourReflection || reflection.reflection || 'No reflection saved'}
                        </div>
                        <div class="partner-answer">
                            <strong>Partner:</strong><br>
                            ${reflection.partnerReflection || 'No reflection from partner'}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Date Night Questions Management
        function loadDateNightQuestions() {
            shuffledDateQuestions = [...dateNightQuestions].sort(() => Math.random() - 0.5);
            currentDateCardIndex = 0;
            displayCurrentDateCard();
        }

        function displayCurrentDateCard() {
            const question = shuffledDateQuestions[currentDateCardIndex];
            document.getElementById('dateQuestion').textContent = question;
            document.getElementById('cardNumber').textContent = `${currentDateCardIndex + 1} / 250`;
            
            // Update button states
            const prevBtn = document.getElementById('prevBtn');
            prevBtn.disabled = currentDateCardIndex === 0;
            prevBtn.style.opacity = currentDateCardIndex === 0 ? '0.5' : '1';
        }

        function nextDateCard() {
            if (currentDateCardIndex < shuffledDateQuestions.length - 1) {
                currentDateCardIndex++;
                displayCurrentDateCard();
            }
        }

        function previousDateCard() {
            if (currentDateCardIndex > 0) {
                currentDateCardIndex--;
                displayCurrentDateCard();
            }
        }

        function shuffleDateCards() {
            shuffledDateQuestions = [...dateNightQuestions].sort(() => Math.random() - 0.5);
            currentDateCardIndex = 0;
            displayCurrentDateCard();
        }

        // Couple Management
        function generateCoupleId() {
            let saved = localStorage.getItem('coupleId');
            if (!saved) {
                saved = generateRandomCode();
                localStorage.setItem('coupleId', saved);
            }
            coupleId = saved;
            document.getElementById('coupleIdDisplay').textContent = coupleId;
        }

        function generateRandomCode() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let result = '';
            for (let i = 0; i < 8; i++) {
                result += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return result;
        }

        function generateNewCode() {
            const newCode = generateRandomCode();
            localStorage.setItem('coupleId', newCode);
            coupleId = newCode;
            document.getElementById('coupleIdDisplay').textContent = coupleId;
            
            // Reset partner connection
            partnerConnected = false;
            updateSyncStatus();
            
            // Restart real-time sync with new code
            if (partnerReflectionListener) {
                partnerReflectionListener();
            }
            setupRealtimeSync();
            
            alert('New couple code generated! Share this with your partner to sync your questions.');
        }

        function connectPartner() {
            const partnerCode = document.getElementById('partnerCode').value.trim().toUpperCase();
            
            if (!partnerCode) {
                showAuthMessage('Please enter your partner\'s code.', true);
                return;
            }
            
            if (partnerCode === coupleId) {
                showAuthMessage('You cannot connect to your own code!', true);
                return;
            }
            
            if (!currentUser) {
                showAuthMessage('Please sign in to connect with your partner.', true);
                return;
            }
            
            // Check if partner code exists and connect
            db.collection('users').where('coupleId', '==', partnerCode).get()
                .then(querySnapshot => {
                    if (querySnapshot.empty) {
                        showAuthMessage('Partner code not found. Please check the code and try again.', true);
                        return;
                    }
                    
                    // Update both users' couple connection
                    const batch = db.batch();
                    
                    // Update current user
                    const currentUserRef = db.collection('users').doc(currentUser.uid);
                    batch.update(currentUserRef, {
                        partnerCode: partnerCode,
                        connectedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    
                    // Update partner
                    querySnapshot.forEach(doc => {
                        const partnerRef = db.collection('users').doc(doc.id);
                        batch.update(partnerRef, {
                            partnerCode: coupleId,
                            connectedAt: firebase.firestore.FieldValue.serverTimestamp()
                        });
                    });
                    
                    return batch.commit();
                })
                .then(() => {
                    partnerConnected = true;
                    updateSyncStatus();
                    setupRealtimeSync();
                    showAuthMessage('Successfully connected to your partner! You\'ll now sync in real-time. 💕');
                })
                .catch(error => {
                    console.error('Error connecting partner:', error);
                    showAuthMessage('Failed to connect with partner. Please try again.', true);
                });
        }

        function updateSyncStatus() {
            const statusEl = document.getElementById('syncStatus');
            if (partnerConnected) {
                statusEl.textContent = 'Connected to partner ✓';
                statusEl.className = 'sync-status connected';
            } else {
                statusEl.textContent = 'Not connected to partner';
                statusEl.className = 'sync-status disconnected';
            }
        }

        // Counters Management
        function updateAllCounters() {
            updateDaysCounter();
            updateQuestionsCounter();
            updateStreakCounter();
        }

        function updateDaysCounter() {
            let anniversaryDate = localStorage.getItem('anniversaryDate');
            
            const numberElement = document.getElementById('daysNumber');
            
            if (!anniversaryDate) {
                numberElement.textContent = '0';
                return;
            }
            
            // Parse the anniversary date properly
            const anniversary = new Date(anniversaryDate);
            const today = new Date();
            
            // Set both dates to midnight for accurate day calculation
            anniversary.setHours(0, 0, 0, 0);
            today.setHours(0, 0, 0, 0);
            
            // Calculate difference in milliseconds and convert to days
            const diffTime = today.getTime() - anniversary.getTime();
            const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
            
            if (diffDays < 0) {
                numberElement.textContent = '0';
            } else if (diffDays === 0) {
                numberElement.textContent = '💕';
            } else {
                numberElement.textContent = diffDays.toString();
            }
        }

        function updateQuestionsCounter() {
            const answeredQuestions = JSON.parse(localStorage.getItem('answeredQuestions') || '[]');
            const count = answeredQuestions.length;
            const numberElement = document.getElementById('questionsNumber');
            
            numberElement.textContent = count.toString();
        }

        function updateStreakCounter() {
            const streak = calculateCurrentStreak();
            const numberElement = document.getElementById('streakNumber');
            
            numberElement.textContent = streak.toString();
        }

        function calculateCurrentStreak() {
            const answeredDates = JSON.parse(localStorage.getItem('answeredDates') || '[]');
            if (answeredDates.length === 0) return 0;
            
            // Sort dates in descending order
            answeredDates.sort((a, b) => new Date(b) - new Date(a));
            
            const today = new Date().toDateString();
            let streak = 0;
            let currentDate = new Date();
            
            // Check if answered today or yesterday to start streak
            if (answeredDates.includes(today)) {
                streak = 1;
                currentDate.setDate(currentDate.getDate() - 1);
            } else if (answeredDates.includes(new Date(currentDate.getTime() - 24 * 60 * 60 * 1000).toDateString())) {
                streak = 1;
                currentDate.setDate(currentDate.getDate() - 2);
            } else {
                return 0;
            }
            
            // Count consecutive days backwards
            while (answeredDates.includes(currentDate.toDateString())) {
                streak++;
                currentDate.setDate(currentDate.getDate() - 1);
            }
            
            return streak;
        }

        function recordQuestionAnswered() {
            const today = new Date().toDateString();
            
            // Record answered question
            const answeredQuestions = JSON.parse(localStorage.getItem('answeredQuestions') || '[]');
            const questionId = `${today}_${todaysQuestion.category}_${todaysQuestion.question}`;
            
            if (!answeredQuestions.includes(questionId)) {
                answeredQuestions.push(questionId);
                localStorage.setItem('answeredQuestions', JSON.stringify(answeredQuestions));
            }
            
            // Record answered date
            const answeredDates = JSON.parse(localStorage.getItem('answeredDates') || '[]');
            if (!answeredDates.includes(today)) {
                answeredDates.push(today);
                localStorage.setItem('answeredDates', JSON.stringify(answeredDates));
            }
            
            // Update counters
            updateAllCounters();
        }

        function updateDateHeader() {
            const today = new Date();
            const options = { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            };
            document.getElementById('dateHeader').textContent = today.toLocaleDateString('en-US', options);
        }

        function updateWeeklyHeader() {
            const today = new Date();
            const startOfWeek = new Date(today);
            startOfWeek.setDate(today.getDate() - today.getDay());
            
            const options = { month: 'long', day: 'numeric', year: 'numeric' };
            document.getElementById('weeklyDateHeader').textContent = `Week of ${startOfWeek.toLocaleDateString('en-US', options)}`;
        }

        function updateMonthlyHeader() {
            const today = new Date();
            const options = { month: 'long', year: 'numeric' };
            document.getElementById('monthlyDateHeader').textContent = `Month of ${today.toLocaleDateString('en-US', options)}`;
        }

        function saveWeeklyReflection() {
            const reflectionText = document.getElementById('yourWeeklyReflection').value.trim();
            
            if (!reflectionText) {
                showAuthMessage('Please write your weekly reflection before saving.', true);
                return;
            }
            
            if (!currentUser) {
                showAuthMessage('Please sign in to save your reflection.', true);
                return;
            }
            
            const weekKey = getWeekKey();
            const reflection = {
                id: Date.now(),
                week: weekKey,
                reflection: reflectionText,
                userId: currentUser.uid,
                userEmail: currentUser.email,
                userName: currentUser.displayName || currentUser.email,
                coupleId: coupleId,
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            };
            
            // Save to Firebase
            db.collection('weeklyReflections').add(reflection);
            
            showAuthMessage('Weekly reflection saved successfully! 💕');
        }

        function saveMonthlyGoal() {
            const goalText = document.getElementById('yourMonthlyGoal').value.trim();
            
            if (!goalText) {
                showAuthMessage('Please write your monthly goal before saving.', true);
                return;
            }
            
            if (!currentUser) {
                showAuthMessage('Please sign in to save your goal.', true);
                return;
            }
            
            const monthKey = getMonthKey();
            const goal = {
                id: Date.now(),
                month: monthKey,
                goal: goalText,
                userId: currentUser.uid,
                userEmail: currentUser.email,
                userName: currentUser.displayName || currentUser.email,
                coupleId: coupleId,
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            };
            
            // Save to Firebase
            db.collection('monthlyGoals').add(goal);
            
            showAuthMessage('Monthly goal saved successfully! 💕');
        }

        function getWeekKey() {
            const today = new Date();
            const startOfWeek = new Date(today);
            startOfWeek.setDate(today.getDate() - today.getDay());
            return startOfWeek.toDateString();
        }

        function getMonthKey() {
            const today = new Date();
            return `${today.getFullYear()}-${today.getMonth()}`;
        }

        function loadWeeklyReflections() {
            if (!coupleId || !currentUser) return;
            
            const weekKey = getWeekKey();
            db.collection('weeklyReflections')
                .where('coupleId', '==', coupleId)
                .where('week', '==', weekKey)
                .get()
                .then(querySnapshot => {
                    let partnerReflection = null;
                    let yourReflection = null;
                    
                    querySnapshot.forEach(doc => {
                        const data = doc.data();
                        if (data.userId === currentUser.uid) {
                            yourReflection = data.reflection;
                        } else {
                            partnerReflection = data;
                        }
                    });
                    
                    if (yourReflection) {
                        document.getElementById('yourWeeklyReflection').value = yourReflection;
                    }
                    
                    if (partnerReflection) {
                        document.getElementById('partnerWeeklyReflectionDisplay').innerHTML = partnerReflection.reflection;
                        document.getElementById('partnerWeeklyReflectionDisplay').style.fontStyle = 'normal';
                        document.getElementById('partnerWeeklyReflectionDisplay').style.color = '#4a5568';
                        document.getElementById('partnerStatusWeekly').className = 'online-indicator';
                    }
                });
        }

        function loadMonthlyGoals() {
            if (!coupleId || !currentUser) return;
            
            const monthKey = getMonthKey();
            db.collection('monthlyGoals')
                .where('coupleId', '==', coupleId)
                .where('month', '==', monthKey)
                .get()
                .then(querySnapshot => {
                    let partnerGoal = null;
                    let yourGoal = null;
                    
                    querySnapshot.forEach(doc => {
                        const data = doc.data();
                        if (data.userId === currentUser.uid) {
                            yourGoal = data.goal;
                        } else {
                            partnerGoal = data;
                        }
                    });
                    
                    if (yourGoal) {
                        document.getElementById('yourMonthlyGoal').value = yourGoal;
                    }
                    
                    if (partnerGoal) {
                        document.getElementById('partnerMonthlyGoalDisplay').innerHTML = partnerGoal.goal;
                        document.getElementById('partnerMonthlyGoalDisplay').style.fontStyle = 'normal';
                        document.getElementById('partnerMonthlyGoalDisplay').style.color = '#4a5568';
                        document.getElementById('partnerStatusMonthly').className = 'online-indicator';
                    }
                });
        }

        // Settings Management
        function loadUserData() {
            if (!currentUser) return;
            
            const displayName = currentUser.displayName || currentUser.email;
            document.getElementById('displayName').value = displayName;
            localStorage.setItem('displayName', displayName);
            
            updateProfileDisplays();
            
            // Load anniversary date
            const savedAnniversary = localStorage.getItem('anniversaryDate');
            if (savedAnniversary) {
                document.getElementById('anniversaryDate').value = savedAnniversary;
            }
        }

        function saveProfileSettings() {
            const displayName = document.getElementById('displayName').value.trim();
            const anniversaryDate = document.getElementById('anniversaryDate').value;
            
            if (!displayName) {
                showAuthMessage('Please enter your display name.', true);
                return;
            }
            
            // Save display name
            localStorage.setItem('displayName', displayName);
            
            // Save anniversary date
            if (anniversaryDate) {
                localStorage.setItem('anniversaryDate', anniversaryDate);
            }
            
            // Update Firebase profile
            if (currentUser) {
                currentUser.updateProfile({
                    displayName: displayName
                }).then(() => {
                    updateProfileDisplays();
                    updateAllCounters();
                    showAuthMessage('Profile settings saved successfully!');
                }).catch(error => {
                    console.error('Error updating profile:', error);
                    showAuthMessage('Profile updated locally. Some changes may not sync.', false);
                });
            } else {
                // Show success message even without Firebase
                updateProfileDisplays();
                updateAllCounters();
                showAuthMessage('Profile settings saved successfully!');
            }
        }

        function exportData() {
            const data = {
                reflections: reflections,
                answeredQuestions: JSON.parse(localStorage.getItem('answeredQuestions') || '[]'),
                answeredDates: JSON.parse(localStorage.getItem('answeredDates') || '[]'),
                displayName: localStorage.getItem('displayName'),
                anniversaryDate: localStorage.getItem('anniversaryDate'),
                coupleId: coupleId
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = 'kingdom-connection-data.json';
            link.click();
            
            URL.revokeObjectURL(url);
            showAuthMessage('Data exported successfully!');
        }

        function checkMobileView() {
            const mobileNav = document.getElementById('mobileNav');
            if (window.innerWidth <= 768) {
                mobileNav.classList.remove('hidden');
            } else {
                mobileNav.classList.add('hidden');
            }
        }

        // Event Listeners
        window.addEventListener('resize', checkMobileView);
        
        // Handle Enter key for login
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                const loginForm = document.getElementById('loginForm');
                const signUpForm = document.getElementById('signUpForm');
                const forgotForm = document.getElementById('forgotPasswordForm');
                
                if (loginForm.style.display !== 'none') {
                    signInUser();
                } else if (signUpForm.style.display !== 'none') {
                    signUpUser();
                } else if (forgotForm.style.display !== 'none') {
                    resetPassword();
                }
            }
        });

        // Initialize the app when page loads
        document.addEventListener('DOMContentLoaded', initializeApp);
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'98f3d9941509fab2',t:'MTc2MDU3ODg0NC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script>
